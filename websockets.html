<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
<title>WebSockets - Dive Into Unicorn Magic âœ¨ğŸ¦„</title>
<link rel="stylesheet" href="unicorn-style.css">
<style>
h1:before{content:"Real-Time Magic: "}
</style>
</head>
<body>

<p>ğŸ¦„ You are here: <a href="index.html">Unicorn Home</a> <span class="u">âœ¨</span> <a href="index.html">Dive Into Unicorn Magic</a> <span class="u">âœ¨</span></p>

<h1><br>Instant Unicorn Communication</h1>

<p class="a">ğŸŒŸ âœ¨ ğŸŒˆ</p>

<p class="f"><span style="font-size:4em;float:left;line-height:0.8;margin:0.1em 0.2em 0 0;background:linear-gradient(45deg,#ffd700,#ff69b4,#87ceeb,#9b59b6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-weight:bold;">W</span>ebSockets enable real-time, bidirectional communication between your browser and a server â€” like having a magical telepathic connection between unicorns! Unlike traditional HTTP requests, WebSockets maintain a persistent connection, allowing instant message exchange in both directions.</p>

<h2>ğŸ”Œ What Are WebSockets?</h2>

<p>WebSockets provide full-duplex communication over a single TCP connection. Perfect for:</p>

<ul style="list-style:disc;padding-left:2em;">
<li style="margin:0.5em 0;">ğŸ’¬ Chat applications</li>
<li style="margin:0.5em 0;">ğŸ® Real-time gaming</li>
<li style="margin:0.5em 0;">ğŸ“Š Live data feeds (stock prices, sports scores)</li>
<li style="margin:0.5em 0;">ğŸ‘¥ Collaborative editing</li>
<li style="margin:0.5em 0;">ğŸ”” Push notifications</li>
<li style="margin:0.5em 0;">ğŸµ Live streaming metadata</li>
</ul>

<h2>ğŸš€ Basic WebSocket Connection (2025)</h2>

<pre><code>// Connect to WebSocket server
const socket = new WebSocket('wss://unicorn.example.com/chat');

// Connection opened
socket.addEventListener('open', (event) => {
  console.log('âœ… Connected to unicorn realm!');
  socket.send(JSON.stringify({
    type: 'join',
    username: 'Sparkles'
  }));
});

// Receive messages
socket.addEventListener('message', (event) => {
  const data = JSON.parse(event.data);
  console.log('ğŸ“¨ Message from server:', data);
  displayMessage(data);
});

// Handle errors
socket.addEventListener('error', (error) => {
  console.error('âŒ WebSocket error:', error);
});

// Connection closed
socket.addEventListener('close', (event) => {
  console.log('ğŸ”Œ Disconnected:', event.code, event.reason);
  if (!event.wasClean) {
    console.log('Connection lost unexpectedly');
  }
});

// Send message
function sendMessage(text) {
  if (socket.readyState === WebSocket.OPEN) {
    socket.send(JSON.stringify({
      type: 'message',
      text: text,
      timestamp: Date.now()
    }));
  } else {
    console.warn('Socket not ready');
  }
}</code></pre>

<h2>ğŸ¯ Connection States</h2>

<pre><code>// Check connection state
switch (socket.readyState) {
  case WebSocket.CONNECTING: // 0
    console.log('ğŸ”„ Connecting...');
    break;
  case WebSocket.OPEN: // 1
    console.log('âœ… Connected');
    break;
  case WebSocket.CLOSING: // 2
    console.log('â³ Closing...');
    break;
  case WebSocket.CLOSED: // 3
    console.log('âŒ Closed');
    break;
}</code></pre>

<h2>ğŸ’¬ Complete Chat Example</h2>

<pre><code>class UnicornChat {
  constructor(url) {
    this.url = url;
    this.socket = null;
    this.messageHandlers = [];
    this.reconnectAttempts = 0;
    this.maxReconnectAttempts = 5;
  }
  
  connect() {
    this.socket = new WebSocket(this.url);
    
    this.socket.onopen = () => {
      console.log('âœ… Connected!');
      this.reconnectAttempts = 0;
      this.onConnect?.();
    };
    
    this.socket.onmessage = (event) => {
      try {
        const data = JSON.parse(event.data);
        this.messageHandlers.forEach(handler => handler(data));
      } catch (e) {
        console.error('Failed to parse message:', e);
      }
    };
    
    this.socket.onerror = (error) => {
      console.error('âŒ WebSocket error:', error);
      this.onError?.(error);
    };
    
    this.socket.onclose = (event) => {
      console.log('ğŸ”Œ Disconnected');
      this.onDisconnect?.(event);
      
      // Auto-reconnect with exponential backoff
      if (!event.wasClean && this.reconnectAttempts < this.maxReconnectAttempts) {
        const delay = Math.min(1000 * Math.pow(2, this.reconnectAttempts), 30000);
        console.log(`Reconnecting in ${delay}ms...`);
        
        setTimeout(() => {
          this.reconnectAttempts++;
          this.connect();
        }, delay);
      }
    };
  }
  
  send(type, data) {
    if (this.socket?.readyState === WebSocket.OPEN) {
      this.socket.send(JSON.stringify({ type, ...data }));
    } else {
      console.warn('Cannot send: Socket not open');
    }
  }
  
  onMessage(handler) {
    this.messageHandlers.push(handler);
  }
  
  disconnect() {
    this.maxReconnectAttempts = 0; // Prevent reconnection
    this.socket?.close(1000, 'Client disconnect');
  }
}

// Usage
const chat = new UnicornChat('wss://unicorn-chat.example.com');

chat.onConnect = () => {
  chat.send('join', { username: 'Sparkles' });
};

chat.onMessage((data) => {
  if (data.type === 'message') {
    addMessageToUI(data.username, data.text);
  } else if (data.type === 'userJoined') {
    showNotification(`${data.username} joined!`);
  }
});

chat.connect();

// Send message
document.getElementById('sendBtn').onclick = () => {
  const input = document.getElementById('messageInput');
  chat.send('message', { text: input.value });
  input.value = '';
};</code></pre>

<h2>ğŸ” Secure WebSockets (WSS)</h2>

<p><strong>Always use WSS (WebSocket Secure) in production!</strong></p>

<pre><code>// âœ… Secure connection (recommended)
const socket = new WebSocket('wss://unicorn.example.com/chat');

// âŒ Insecure (only for local development)
const socket = new WebSocket('ws://localhost:8080/chat');</code></pre>

<p>ğŸ’¡ WSS is to WS what HTTPS is to HTTP. Modern browsers require WSS for security!</p>

<h2>ğŸ® Binary Data Support</h2>

<p>WebSockets can send/receive binary data efficiently:</p>

<pre><code>// Configure binary type
socket.binaryType = 'arraybuffer'; // or 'blob'

// Send binary data (game state, images, etc.)
const buffer = new ArrayBuffer(1024);
const view = new Uint8Array(buffer);
view[0] = 42;
socket.send(buffer);

// Receive binary data
socket.addEventListener('message', (event) => {
  if (event.data instanceof ArrayBuffer) {
    const view = new Uint8Array(event.data);
    console.log('Binary data received:', view[0]);
  } else {
    // Text message
    const data = JSON.parse(event.data);
  }
});</code></pre>

<h2>ğŸ“Š Practical Examples</h2>

<h3>Live Dashboard (Stock Ticker Style)</h3>
<pre><code>class LiveDashboard {
  constructor() {
    this.socket = new WebSocket('wss://api.example.com/stream');
    this.setupListeners();
  }
  
  setupListeners() {
    this.socket.onmessage = (event) => {
      const update = JSON.parse(event.data);
      
      switch(update.type) {
        case 'unicornCount':
          this.updateCount(update.count);
          break;
        case 'powerLevel':
          this.updatePowerMeter(update.level);
          break;
        case 'alert':
          this.showAlert(update.message);
          break;
      }
    };
  }
  
  updateCount(count) {
    document.getElementById('unicornCount').textContent = count;
    document.getElementById('unicornCount').classList.add('pulse');
    setTimeout(() => {
      document.getElementById('unicornCount').classList.remove('pulse');
    }, 300);
  }
}

const dashboard = new LiveDashboard();</code></pre>

<h3>Multiplayer Game State Sync</h3>
<pre><code>class GameClient {
  constructor(gameId) {
    this.socket = new WebSocket(`wss://game.example.com/${gameId}`);
    this.playerId = null;
    
    this.socket.onmessage = (event) => {
      const msg = JSON.parse(event.data);
      
      switch(msg.type) {
        case 'joined':
          this.playerId = msg.playerId;
          break;
        case 'gameState':
          this.updateGameState(msg.state);
          break;
        case 'playerMoved':
          this.updatePlayerPosition(msg.playerId, msg.x, msg.y);
          break;
      }
    };
  }
  
  sendMove(x, y) {
    this.socket.send(JSON.stringify({
      type: 'move',
      playerId: this.playerId,
      x: x,
      y: y,
      timestamp: Date.now()
    }));
  }
}

const game = new GameClient('unicorn-race-123');</code></pre>

<h2>ğŸ”„ Heartbeat / Ping-Pong</h2>

<p>Keep connection alive with periodic heartbeats:</p>

<pre><code>class WebSocketWithHeartbeat {
  constructor(url) {
    this.url = url;
    this.pingInterval = null;
    this.pongTimeout = null;
    this.connect();
  }
  
  connect() {
    this.socket = new WebSocket(this.url);
    
    this.socket.onopen = () => {
      console.log('Connected!');
      this.startHeartbeat();
    };
    
    this.socket.onmessage = (event) => {
      const data = JSON.parse(event.data);
      
      if (data.type === 'pong') {
        console.log('ğŸ’š Pong received');
        clearTimeout(this.pongTimeout);
      } else {
        this.handleMessage(data);
      }
    };
    
    this.socket.onclose = () => {
      this.stopHeartbeat();
    };
  }
  
  startHeartbeat() {
    this.pingInterval = setInterval(() => {
      if (this.socket.readyState === WebSocket.OPEN) {
        this.socket.send(JSON.stringify({ type: 'ping' }));
        
        // Expect pong within 5 seconds
        this.pongTimeout = setTimeout(() => {
          console.warn('No pong received, reconnecting...');
          this.socket.close();
          this.connect();
        }, 5000);
      }
    }, 30000); // Ping every 30 seconds
  }
  
  stopHeartbeat() {
    clearInterval(this.pingInterval);
    clearTimeout(this.pongTimeout);
  }
}</code></pre>

<h2>ğŸ†š WebSockets vs HTTP/Polling</h2>

<table style="width:100%;margin:2em 0;border-collapse:collapse;">
<thead>
<tr style="background:linear-gradient(135deg,#667eea,#764ba2);">
<th style="padding:1em;color:white;">Feature</th>
<th style="padding:1em;color:white;">WebSockets</th>
<th style="padding:1em;color:white;">HTTP/Polling</th>
</tr>
</thead>
<tbody>
<tr>
<td style="padding:0.8em;border:1px solid #ddd;"><strong>Connection</strong></td>
<td style="padding:0.8em;border:1px solid #ddd;">âœ… Persistent</td>
<td style="padding:0.8em;border:1px solid #ddd;">âŒ Request-response</td>
</tr>
<tr>
<td style="padding:0.8em;border:1px solid #ddd;"><strong>Latency</strong></td>
<td style="padding:0.8em;border:1px solid #ddd;">âœ… <1ms</td>
<td style="padding:0.8em;border:1px solid #ddd;">âŒ 100ms-1s+</td>
</tr>
<tr>
<td style="padding:0.8em;border:1px solid #ddd;"><strong>Bandwidth</strong></td>
<td style="padding:0.8em;border:1px solid #ddd;">âœ… Low overhead</td>
<td style="padding:0.8em;border:1px solid #ddd;">âŒ High (headers each time)</td>
</tr>
<tr>
<td style="padding:0.8em;border:1px solid #ddd;"><strong>Server Push</strong></td>
<td style="padding:0.8em;border:1px solid #ddd;">âœ… Native</td>
<td style="padding:0.8em;border:1px solid #ddd;">âŒ Requires polling</td>
</tr>
<tr>
<td style="padding:0.8em;border:1px solid #ddd;"><strong>Complexity</strong></td>
<td style="padding:0.8em;border:1px solid #ddd;">âš ï¸ Moderate</td>
<td style="padding:0.8em;border:1px solid #ddd;">âœ… Simple</td>
</tr>
</tbody>
</table>

<h2>ğŸ“š Modern Alternatives & Libraries</h2>

<p><strong>Socket.IO</strong> â€” Most popular WebSocket library with fallbacks:</p>
<pre><code>// Automatically handles reconnection, fallbacks, etc.
const socket = io('https://unicorn.example.com');

socket.on('connect', () => {
  console.log('Connected!');
});

socket.on('unicornUpdate', (data) => {
  console.log('Update:', data);
});

socket.emit('sendMessage', { text: 'Hello!' });</code></pre>

<p><strong>Other modern options:</strong></p>
<ul style="list-style:disc;padding-left:2em;">
<li style="margin:0.5em 0;"><strong>Socket.IO</strong> â€” Feature-rich, auto-reconnect, room support</li>
<li style="margin:0.5em 0;"><strong>SockJS</strong> â€” WebSocket emulation with fallbacks</li>
<li style="margin:0.5em 0;"><strong>WS (Node.js)</strong> â€” Fast, lightweight WebSocket server</li>
<li style="margin:0.5em 0;"><strong>uWebSockets</strong> â€” Ultra-fast C++ WebSocket library</li>
</ul>

<h2>ğŸ’¡ 2025 Best Practices</h2>

<ol style="list-style:decimal;padding-left:2em;">
<li style="margin:1em 0;"><strong>Always use WSS</strong> â€” Secure connections only in production</li>
<li style="margin:1em 0;"><strong>Implement reconnection logic</strong> â€” Networks aren't perfect</li>
<li style="margin:1em 0;"><strong>Use heartbeats</strong> â€” Detect dead connections early</li>
<li style="margin:1em 0;"><strong>Handle backpressure</strong> â€” Don't overwhelm clients with messages</li>
<li style="margin:1em 0;"><strong>Validate all messages</strong> â€” Never trust client input</li>
<li style="margin:1em 0;"><strong>Use JSON for structure</strong> â€” Binary for performance-critical data</li>
<li style="margin:1em 0;"><strong>Implement authentication</strong> â€” Secure your WebSocket endpoints</li>
<li style="margin:1em 0;"><strong>Monitor connections</strong> â€” Track active connections and bandwidth</li>
</ol>

<p class="a">ğŸŒŸ âœ¨ ğŸŒˆ</p>

<p><a href="dragdrop.html">Continue to Drag & Drop: Moving Unicorns Around â†’</a></p>

<div class="pf">
<h4>ğŸ”Œ 2025 WebSocket Wisdom ğŸ”Œ</h4>
<div class="moneybags">
<p><strong>Universal Support:</strong> WebSockets work in all modern browsers. Perfect for real-time features!</p>
<p style="margin-top:1em;"><strong>When to use WebSockets:</strong></p>
<ul style="list-style:disc;padding-left:2em;margin-top:0.5em;">
<li>Chat/messaging apps</li>
<li>Real-time dashboards</li>
<li>Multiplayer games</li>
<li>Collaborative tools</li>
<li>Live notifications</li>
<li>Streaming data feeds</li>
</ul>
<p style="margin-top:1em;"><strong>Server-side:</strong> Popular WebSocket servers include Socket.IO, WS (Node), Django Channels (Python), Phoenix (Elixir), and many more!</p>
<p style="margin-top:1em;">âš¡ <strong>Performance:</strong> WebSockets are much more efficient than polling. A single connection can handle thousands of messages per second!</p>
<p style="margin-top:1em;">ğŸ“š <strong>Resources:</strong> <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API" target="_blank" style="color:#9b59b6;font-weight:bold;">MDN WebSockets</a></p>
</div>
</div>

<p class="c">ğŸ¦„ Enchanted with Unicorn Magic ğŸ¦„<br>
<small style="opacity:0.7;">Modern web standards â€¢ Unicorn magic by Web Wizards</small></p>

<script src="j/jquery.js"></script>
<script src="j/dih5.js"></script>

</body>
</html>
