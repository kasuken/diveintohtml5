<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
<title>History API - Dive Into Unicorn Magic âœ¨ğŸ¦„</title>
<link rel="stylesheet" href="unicorn-style.css">
</head>
<body>

<p>ğŸ¦„ You are here: <a href="index.html">Unicorn Home</a> <span class="u">âœ¨</span> <a href="index.html">Dive Into Unicorn Magic</a> <span class="u">âœ¨</span></p>

<h1>Time-Traveling Unicorns: Manipulating History with Grace</h1>

<p class="a">ğŸŒŸ âœ¨ ğŸŒˆ</p>

<p class="f"><span style="font-size:4em;float:left;line-height:0.8;margin:0.1em 0.2em 0 0;background:linear-gradient(45deg,#ffd700,#ff69b4,#87ceeb);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-weight:bold;">T</span>he History API lets you manipulate the browser's history stack, enabling smooth single-page applications where unicorns can gallop from page to page without full reloads!</p>

<h2>â®ï¸ Basic Navigation</h2>

<pre><code>// Go back (like clicking the back button)
history.back();

// Go forward
history.forward();

// Go to a specific point in history
history.go(-2);  // Go back 2 pages
history.go(1);   // Go forward 1 page</code></pre>

<h2>â• Adding to History</h2>

<p>The magical <code>pushState()</code> method adds a new entry to the history:</p>

<pre><code>// Add a new state
history.pushState(
  {unicorn: 'Sparkles', page: 1},  // State object (data)
  'Unicorn Profile',                // Title (often ignored)
  '/unicorn/sparkles'               // URL
);

// The URL changes, but the page doesn't reload! âœ¨</code></pre>

<h2>ğŸ”„ Replacing History</h2>

<p>Use <code>replaceState()</code> to modify the current history entry without adding a new one:</p>

<pre><code>history.replaceState(
  {unicorn: 'Rainbow', page: 1},
  'Rainbow Profile',
  '/unicorn/rainbow'
);</code></pre>

<h2>ğŸ§ Listening to History Changes</h2>

<p>The <code>popstate</code> event fires when the user navigates (back/forward buttons):</p>

<pre><code>window.addEventListener('popstate', function(event) {
  if (event.state) {
    console.log('State:', event.state);
    // Load content for this state
    loadUnicornPage(event.state.unicorn);
  }
});</code></pre>

<h2>ğŸ¯ Complete Single-Page App Example</h2>

<pre><code>// Navigation function
function navigateTo(unicornName) {
  // Update the content
  loadUnicornContent(unicornName);
  
  // Add to history
  history.pushState(
    {unicorn: unicornName},
    `Unicorn: ${unicornName}`,
    `/unicorn/${unicornName}`
  );
}

// Handle back/forward buttons
window.addEventListener('popstate', function(event) {
  if (event.state && event.state.unicorn) {
    loadUnicornContent(event.state.unicorn);
  } else {
    loadHomePage();
  }
});

// Handle link clicks
document.addEventListener('click', function(e) {
  if (e.target.matches('a.unicorn-link')) {
    e.preventDefault();
    const unicorn = e.target.dataset.unicorn;
    navigateTo(unicorn);
  }
});

function loadUnicornContent(name) {
  // Fetch and display content
  fetch(`/api/unicorns/${name}`)
    .then(r => r.json())
    .then(data => {
      document.getElementById('content').innerHTML = `
        &lt;h2&gt;ğŸ¦„ ${data.name}&lt;/h2&gt;
        &lt;p&gt;Power: ${data.power}&lt;/p&gt;
        &lt;p&gt;Color: ${data.color}&lt;/p&gt;
      `;
    });
}</code></pre>

<h2>ğŸ’¡ Best Practices</h2>

<ol style="list-style:decimal;padding-left:2em;">
<li style="margin:0.5em 0;"><strong>Always store meaningful state</strong> â€” enough to recreate the page if the user returns to it</li>
<li style="margin:0.5em 0;"><strong>Update the URL</strong> to match the content, so users can bookmark and share</li>
<li style="margin:0.5em 0;"><strong>Handle the initial page load</strong> â€” check the URL and load appropriate content</li>
<li style="margin:0.5em 0;"><strong>Make links work</strong> even without JavaScript (progressive enhancement)</li>
<li style="margin:0.5em 0;"><strong>Test back/forward buttons</strong> thoroughly!</li>
</ol>

<h2>ğŸš€ Modern Router Pattern</h2>

<pre><code>class UnicornRouter {
  constructor(routes) {
    this.routes = routes;
    
    // Handle clicks on links
    document.addEventListener('click', (e) => {
      if (e.target.matches('[data-link]')) {
        e.preventDefault();
        this.navigateTo(e.target.href);
      }
    });
    
    // Handle back/forward
    window.addEventListener('popstate', () => {
      this.loadPage(window.location.pathname);
    });
    
    // Load initial page
    this.loadPage(window.location.pathname);
  }
  
  navigateTo(url) {
    history.pushState(null, null, url);
    this.loadPage(url);
  }
  
  loadPage(path) {
    const route = this.routes[path] || this.routes['/404'];
    route();
  }
}

// Usage
const router = new UnicornRouter({
  '/': () => loadHomePage(),
  '/about': () => loadAboutPage(),
  '/unicorns': () => loadUnicornsPage(),
  '/404': () => load404Page()
});</code></pre>

<h2>âš¡ State Object Limits</h2>

<p>The state object has size limits (usually around 640KB). Don't store:</p>
<ul style="list-style:disc;padding-left:2em;">
<li style="margin:0.5em 0;">Large datasets (fetch them instead)</li>
<li style="margin:0.5em 0;">DOM elements (they can't be serialized)</li>
<li style="margin:0.5em 0;">Functions (store data, not logic)</li>
</ul>

<blockquote>
<p>"Good history management makes your app feel instant, like a unicorn's teleportation spell!"</p>
<cite>â€” SPA Wizard Wisdom</cite>
</blockquote>

<p class="a">ğŸŒŸ âœ¨ ğŸŒˆ</p>

<p><a href="everything.html">Continue to Appendix A: The Complete Spellbook â†’</a></p>

<div class="pf">
<h4>ğŸ•°ï¸ History Tips ğŸ•°ï¸</h4>
<div class="moneybags">
<p>The History API is the foundation of modern single-page applications. Combined with fetch() for loading data, you can create incredibly smooth user experiences!</p>
<p style="margin-top:1em;">Popular frameworks like React Router, Vue Router, and Angular Router all use the History API under the hood.</p>
</div>
</div>

<p class="c">ğŸ¦„ Enchanted with Unicorn Magic ğŸ¦„<br>
<small style="opacity:0.7;">Original wisdom by <a href="about.html">Mark Pilgrim</a> â€¢ Unicorn magic by Web Wizards</small></p>

<script src="j/jquery.js"></script>
<script src="j/dih5.js"></script>

</body>
</html>
